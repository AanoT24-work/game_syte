{% extends 'main/main.html' %}

{% block title %}
    {% if current_user.is_authenticated and current_user.id == user.id %}
        –ú–æ–π –∞–∫–∫–∞—É–Ω—Ç
    {% else %}
        –ê–∫–∫–∞—É–Ω—Ç {{ user.login }}
    {% endif %}
{% endblock %}

{% block style %}
    <link rel="stylesheet" href="{{url_for('static', filename='css/blocks/body/accaunt.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/blocks/body/modal/user-post_overlay.css')}}">
{% endblock %}

{% block content %}
<div class="main-container">
    <div class="accaunt-container">
        <div class="info-container">
            <!-- –ö–Ω–æ–ø–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
            {% if current_user.is_authenticated and current_user.id == user.id %}
                <button class="user-avatar" id="openAvatarModal" data-has-avatar="{{ 'true' if user.avatar and user.avatar != 'default_avatar.png' else 'false' }}">
                    {% if user.avatar and user.avatar != 'default_avatar.png' %}
                        <img src="{{ url_for('user.get_avatar', user_id=user.id) }}?t={{ user.updated_at.timestamp() if user.updated_at else '' }}" alt="–ê–≤–∞—Ç–∞—Ä">
                    {% else %}
                        <span>üë§</span>
                    {% endif %}
                </button>
            {% else %}
                <!-- –î–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –±–µ–∑ –∫–Ω–æ–ø–∫–∏ -->
                <div class="user-avatar-static">
                    {% if user.avatar and user.avatar != 'default_avatar.png' %}
                        <img src="{{ url_for('user.get_avatar', user_id=user.id) }}?t={{ user.updated_at.timestamp() if user.updated_at else '' }}" alt="–ê–≤–∞—Ç–∞—Ä">
                    {% else %}
                        <span>üë§</span>
                    {% endif %}
                </div>
            {% endif %}
            
            <span class="publication-text">
                {% if current_user.is_authenticated and current_user.id == user.id %}
                    –ú–æ–π –∞–∫–∫–∞—É–Ω—Ç
                {% else %}
                    –ê–∫–∫–∞—É–Ω—Ç {{ user.login }}
                {% endif %}
            </span>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
            {% if current_user.is_authenticated and current_user.id == user.id %}
                <button class="add_nev-post" id="openPostModal">‚ûï</button>
            {% endif %}
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-posts-container" style="padding: 20px; color: white;">
        <div class="post-information">
            <h3>
                {% if current_user.is_authenticated and current_user.id == user.id %}
                    –ú–æ–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
                {% else %}
                    –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ {{ user.login }}
                {% endif %}
            </h3>
        </div>
        <div class="posts-grid">
            {% for post in posts %}
                <div class="post-item">
                    {% if post.image %}
                        <div class="post-image-container">
                            <img src="{{ url_for('post.get_post_image', post_id=post.id) }}" 
                                alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" 
                                class="post-image"
                                loading="lazy">
                        </div>
                    {% endif %}
                    <p class="post-content">{{ post.content }}</p>
                    <small class="post-date">{{ post.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞ -->
                    {% if current_user.is_authenticated and current_user.id == post.user_id %}
                    <form method="POST" action="{{ url_for('post.delete_post', post_id=post.id) }}" class="delete-post-form">
                        <button type="submit" class="deleate_button" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                    {% endif %}
                </div>
            {% else %}
                <p class="post-have">
                    {% if current_user.is_authenticated and current_user.id == user.id %}
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤
                    {% else %}
                        –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤
                    {% endif %}
                </p>
            {% endfor %}
        </div>
    </div>
    <div class="background-elements">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="particles"></div>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π -->
<div class="overlay" id="overlay"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–∞) -->
{% if current_user.is_authenticated and current_user.id == user.id %}
<div class="photo-container" id="photoContainer">
    <div class="photo-content">
        <form class="photo-form" id="avatarForm" method="POST" action="{{ url_for('user.upload_avatar_ajax') }}" enctype="multipart/form-data">
            {{ accaunt_form.hidden_tag() }}
            
            <button type="button" class="close-button" id="closeAvatarButton">&times;</button>
            <p class="heading">–ê–≤–∞—Ç–∞—Ä</p>
            
            <div class="file-input-wrapper">
                {{ accaunt_form.avatar(class="photo-input", id="fileInput", accept="image/*") }}
                
                <label for="fileInput" class="file-input-label" id="fileInputLabel">
                    <!-- –ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞ -->
                    {% if user.avatar %}
                        <img class="avatar-preview" id="avatarPreview" 
                             src="{{ url_for('user.get_avatar', user_id=user.id) }}" 
                             alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞">
                    {% else %}
                        <img class="avatar-preview" id="avatarPreview" 
                             src="" 
                             alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞" style="display: none;">
                    {% endif %}
                    <span class="file-input-text" id="fileInputText">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞</span>
                </label>
            </div>

            <div class="photo-button">
                <button type="submit" class="save_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="cancel_button" id="cancelAvatarButton">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="deleate_button" id="deleteButton">–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–∞) -->
<div class="post-container" id="postContainer" style="display: none;">
    <div class="post-content">
        <form class="post-form" id="postForm" method="POST" action="{{ url_for('post.create_post') }}" enctype="multipart/form-data">
            {{ post_form.hidden_tag() }}
            
            <button type="button" class="close-button-post" id="closePostButton">&times;</button>
            <p class="post-heading">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</p>
            
            <div class="file-input-wrapper_post">
                {{ post_form.image(class="post-input", id="postInput", accept="image/*") }}
                
                <label for="postInput" class="post-input-label" id="postInputLabel">
                    <img class="post-preview" id="postPreview" src="">
                    <span class="post-input-text">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
                </label>
                
                <div class="mb-3" id="post-text">
                    {{ post_form.content(class="form-control", placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?")}}
                </div>
            </div>

            <div class="post-button">
                <button type="submit" class="save_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="cancel_button" id="cancelPostButton">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

{% endif %}

<script src="{{ url_for('static', filename='js/body/accaunt.js') }}"></script>
{% endblock %}