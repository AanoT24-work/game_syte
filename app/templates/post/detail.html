{% extends 'main/main.html' %}

{% block title %}–ü–æ—Å—Ç {{ post.id }}{% endblock %}

{% block style %}
    <link rel="stylesheet" href="{{url_for('static', filename='css/blocks/body/all.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/blocks/body/modal/detail.css')}}">
{% endblock %}

{% block content %}
<div class="main-container">
    <div class="post-detail">
        <div class="publick-item"> 
            <div class="publick-info">
                <div class="publick-avatar">
                    {% if post.user.avatar and post.user.avatar != 'default_avatar.png' %}
                        <img src="{{ url_for('user.get_avatar', user_id=post.user.id) }}" alt="–ê–≤–∞—Ç–∞—Ä">
                    {% else %}
                        <span>üë§</span>
                    {% endif %}
                </div>
                <a href="{{ url_for('user.profile', user_id=post.user.id) }}" class="publick-author">Username: {{ post.user.login }}</a>
            </div>
            
            {% if post.image %}
                <div class="publick-image-container">
                    <img src="{{ url_for('post.get_post_image', post_id=post.id) }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" class="publick-image">
                </div>
            {% endif %}
            
            <p class="publick-content">{{ post.content }}</p>
            
            <div class="publick-meta">
                <small class="publick-date">{{ post.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                
                <div class="like-comm-container">
                    <div class="like-wrapper">
                        <button class="like-btn {% if current_user.is_authenticated and current_user.id in (post.liked_by or []) %}liked{% endif %}" 
                               data-post-id="{{ post.id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 18" class="icon favorite">
                                <path d="M14.44 0C12.63 0 11.01 0.88 10 2.23C9.48413 1.53881 8.81426 0.977391 8.04353 0.590295C7.27281 0.203198 6.42247 0.00108555 5.56 0C2.49 0 0 2.5 0 5.59C0 6.78 0.19 7.88 0.52 8.9C2.1 13.9 6.97 16.89 9.38 17.71C9.72 17.83 10.28 17.83 10.62 17.71C13.03 16.89 17.9 13.9 19.48 8.9C19.81 7.88 20 6.78 20 5.59C20 2.5 17.51 0 14.44 0Z"></path>
                            </svg>
                            <span class="like-count" id="like-count-{{ post.id }}">{{ (post.liked_by or [])|length }}</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ publick-item -->
            <div class="comments-section">
                <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments|length }})</h3>
                    
                {% if current_user.is_authenticated %}
                <div class="comment-form">
                    <form method="POST" action="{{ url_for('post.add_comment', post_id=post.id) }}">
                        {{ form.hidden_tag() }}
                        <div class="form-group">
                            {{ form.text(class="form-control", placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...", rows="3") }}
                            {% for error in form.text.errors %}
                                <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        {{ form.submit(class="btn btn-primary") }}
                    </form>
                </div>
                {% endif %}
                    
                <div class="comments-list">
                    {% for comment in post.comments %}
                    <div class="comment-item">
                        <div class="comment-header">
                            <div class="comment-author">
                                <div class="comment-avatar">
                                    {% if comment.user.avatar and comment.user.avatar != 'default_avatar.png' %}
                                        <img src="{{ url_for('user.get_avatar', user_id=comment.user.id) }}" alt="–ê–≤–∞—Ç–∞—Ä">
                                    {% else %}
                                        <span>üë§</span>
                                    {% endif %}
                                </div>
                                <a href="{{ url_for('user.profile', user_id=comment.user.id) }}">{{ comment.user.login }}</a>
                            </div>
                            <small class="comment-date">{{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                                
                            {% if current_user.is_authenticated and current_user.id == comment.user_id %}
                            <form method="POST" action="{{ url_for('post.delete_comment', comment_id=comment.id) }}" class="delete-comment-form">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')">√ó</button>
                            </form>
                            {% endif %}
                        </div>
                        <p class="comment-text">{{ comment.text }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/body/detail.js') }}"></script>
{% endblock %}